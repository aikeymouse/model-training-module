<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Module Components</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Notification Container -->
    <div id="notification-container"></div>
    
    <!-- This file now contains only the modal components that get injected into integrating applications -->
    <!-- The standalone UI has been moved to the Go example app -->

    <!-- Model Info Modal -->
    <div id="model-info-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div class="modal-header">
                <h3>Model Training Pipeline</h3>
            </div>
            <div class="training-controls">
                <div id="training-progress-indicator" class="progress-indicator">
                    <!-- Progress steps will be dynamically generated -->
                </div>
                <div class="modal-actions">
                    <div id="dynamic-controls">
                        <!-- Dynamic controls will be generated based on pipeline config -->
                    </div>
                    <div class="action-buttons">
                        <button id="train-model-btn" class="train-model-btn">Train New Model</button>
                        <button id="configure-pipeline-btn" class="configure-pipeline-btn">Configure Pipeline</button>
                        <button id="test-model-btn" class="test-model-btn">Test Model</button>
                    </div>
                </div>
            </div>
            <div class="modal-columns-container">
                <div id="model-list-column" class="modal-column">
                    <div id="model-list-container">
                        <!-- Model list will be populated by JavaScript -->
                    </div>
                </div>
                <div id="script-log-column" class="modal-column">
                    <div id="script-log-container"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pipeline Configuration Modal -->
    <div id="pipeline-config-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content pipeline-config-content">
            <span class="close-button" id="close-pipeline-config">&times;</span>
            <div class="modal-header">
                <h3>Configure Training Pipeline</h3>
            </div>
            <div class="pipeline-config-body">
                <div class="config-section">
                    <h4>Pipeline Stages</h4>
                    <div id="stages-container">
                        <!-- Stages will be dynamically generated -->
                    </div>
                    
                    <!-- Add New Stage Form -->
                    <div id="add-stage-form" class="add-stage-form" style="display: none;">
                        <h5>Add New Stage</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="stage-id-input">Stage ID:</label>
                                <input type="text" id="stage-id-input" placeholder="e.g., preprocess" required>
                            </div>
                            <div class="form-group">
                                <label for="stage-name-input">Stage Name:</label>
                                <input type="text" id="stage-name-input" placeholder="e.g., Data Preprocessing" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="stage-description-input">Description:</label>
                            <input type="text" id="stage-description-input" placeholder="e.g., Preprocess training data" required>
                        </div>
                        <div class="form-group">
                            <label for="stage-script-input">Script Path:</label>
                            <input type="text" id="stage-script-input" placeholder="e.g., training_yolov8/preprocess.py" required>
                        </div>
                        <div class="form-group">
                            <label for="stage-args-input">Arguments (comma-separated):</label>
                            <input type="text" id="stage-args-input" placeholder="e.g., --input, {data_path}, --output, ./processed">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="stage-enabled-input" checked>
                                Enabled by default
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="stage-optional-input">
                                Optional stage
                            </label>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="save-stage-btn" class="save-btn">Save Stage</button>
                            <button type="button" id="cancel-stage-btn" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    
                    <button id="add-stage-btn" class="add-stage-btn">Add Stage</button>
                </div>
                <div class="config-section">
                    <h4>Variables</h4>
                    <div id="variables-container">
                        <!-- Variables will be dynamically generated -->
                    </div>
                    
                    <!-- Add New Variable Form -->
                    <div id="add-variable-form" class="add-variable-form" style="display: none;">
                        <h5>Add New Variable</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="variable-key-input">Variable Key:</label>
                                <input type="text" id="variable-key-input" placeholder="e.g., batch_size" required>
                            </div>
                            <div class="form-group">
                                <label for="variable-label-input">Label:</label>
                                <input type="text" id="variable-label-input" placeholder="e.g., Batch Size" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="variable-type-select">Variable Type:</label>
                                <select id="variable-type-select" required>
                                    <option value="">Select Type...</option>
                                    <option value="number">Number</option>
                                    <option value="text">Text</option>
                                    <option value="selector">Selector</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="variable-default-input">Default Value:</label>
                                <input type="text" id="variable-default-input" placeholder="e.g., 32">
                            </div>
                        </div>
                        <div id="number-constraints" class="form-row" style="display: none;">
                            <div class="form-group">
                                <label for="variable-min-input">Minimum Value:</label>
                                <input type="number" id="variable-min-input" placeholder="e.g., 1">
                            </div>
                            <div class="form-group">
                                <label for="variable-max-input">Maximum Value:</label>
                                <input type="number" id="variable-max-input" placeholder="e.g., 1000">
                            </div>
                        </div>
                        <div id="selector-options" class="form-row" style="display: none;">
                            <div class="form-group">
                                <label for="variable-options-input">Options (comma-separated):</label>
                                <input type="text" id="variable-options-input" placeholder="e.g., option1, option2, option3">
                                <small>Enter available options separated by commas</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="variable-display-input">
                                Hidden
                            </label>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="save-variable-btn" class="save-btn">Save Variable</button>
                            <button type="button" id="cancel-variable-btn" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    
                    <button id="add-variable-btn" class="add-variable-btn">Add Variable</button>
                </div>
                <div class="config-actions">
                    <button id="save-pipeline-config-btn" class="save-config-btn">Save Configuration</button>
                    <button id="load-default-config-btn" class="load-default-btn">Load Default</button>
                    <button id="export-config-btn" class="export-config-btn">Export Config</button>
                    <input type="file" id="import-config-input" accept=".json" style="display: none;">
                    <button id="import-config-btn" class="import-config-btn">Import Config</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Report Modal -->
    <div id="model-report-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content report-modal-content">
            <span class="close-button" onclick="closeModelReportModal()">&times;</span>
            <div class="modal-header">
                <h3 id="report-modal-title">Model Training Report</h3>
            </div>
            <div id="report-content-container">
                <iframe id="report-iframe" style="width: 100%; height: 70vh; border: none;"></iframe>
            </div>
        </div>
    </div>

    <!-- Test Model Modal -->
    <div id="test-model-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content test-modal-content">
            <span class="close-button" onclick="closeTestModelModal()">&times;</span>
            <div class="modal-header">
                <h3>Test Model on Image</h3>
            </div>
            <div class="test-model-body">
                <div class="test-model-content">
                <!-- Combined Image Area -->
                <div class="test-section">
                    <div class="combined-image-area" id="combined-image-area">
                        <!-- Upload Area -->
                        <div class="file-upload-area" id="file-upload-area">
                            <div class="upload-content">
                                <div class="upload-icon">📁</div>
                                <p>Click to select an image or drag and drop</p>
                                <p class="upload-hint">Supported formats: JPG, PNG, JPEG</p>
                            </div>
                            <input type="file" id="test-image-input" accept="image/*" style="display: none;">
                        </div>
                        
                        <!-- Image Preview -->
                        <div id="selected-image-preview" class="image-preview" style="display: none;">
                            <img id="preview-image" alt="Selected image">
                        </div>
                        
                        <!-- Result Image -->
                        <div id="result-image-container" class="result-image-container" style="display: none;">
                            <img id="result-image" alt="Detection results" class="result-image">
                        </div>
                    </div>
                </div>
                
                <!-- Detection Results Section (Always Visible) -->
                <div class="test-section">
                    <h4>Detection Results</h4>
                    <div id="test-results-content" class="detection-results-content">
                        <p class="no-results">Select an image and click Detect to see results</p>
                    </div>
                </div>
                
                <!-- Detection Settings -->
                <div class="test-section">
                    <h4>Detection Settings</h4>
                    <div class="detection-settings">
                        <div class="form-group">
                            <label for="confidence-threshold-input">Confidence Threshold:</label>
                            <input type="number" id="confidence-threshold-input" 
                                   min="0.01" max="1.0" step="0.01" value="0.25"
                                   placeholder="0.25">
                            <small>Minimum confidence for detections (0.01 - 1.0)</small>
                        </div>
                    </div>
                </div>
                
                <!-- Detect Button -->
                <div class="test-section">
                    <button id="run-test-btn" class="run-test-btn" disabled>Detect</button>
                </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/model.js"></script>
</body>
</html>